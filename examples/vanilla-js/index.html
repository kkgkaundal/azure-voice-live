<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Voice Live SDK - Vanilla JS Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .primary { background-color: #007acc; color: white; }
        .secondary { background-color: #6c757d; color: white; }
        .success { background-color: #28a745; color: white; }
        .danger { background-color: #dc3545; color: white; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .success {
            background-color: #d1edff;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>Azure Voice Live SDK - Vanilla JavaScript</h1>
    
    <div class="config">
        <h3>Configuration</h3>
        <input type="text" id="endpoint" placeholder="Azure Endpoint" style="width: 300px; margin: 5px;">
        <input type="text" id="apiKey" placeholder="API Key" style="width: 300px; margin: 5px;">
        <input type="text" id="model" placeholder="Model" style="width: 300px; margin: 5px;">
    </div>

    <div class="controls">
        <button id="connectBtn" class="primary">Connect</button>
        <button id="recordBtn" class="secondary" disabled>Start Recording</button>
        <button id="playbackBtn" class="secondary" disabled>Start Playback</button>
    </div>

    <div id="status" class="status">Ready to connect</div>
    <div id="sessionInfo"></div>

    <script src="https://unpkg.com/azure-voice-live-sdk/dist/browser/index.js"></script>
    <script>
        let client = null;
        let isConnected = false;
        let isRecording = false;
        let isPlaybackActive = false;

        const elements = {
            endpoint: document.getElementById('endpoint'),
            apiKey: document.getElementById('apiKey'),
            model: document.getElementById('model'),
            connectBtn: document.getElementById('connectBtn'),
            recordBtn: document.getElementById('recordBtn'),
            playbackBtn: document.getElementById('playbackBtn'),
            status: document.getElementById('status'),
            sessionInfo: document.getElementById('sessionInfo')
        };

        function updateStatus(message, type = 'info') {
            elements.status.textContent = message;
            elements.status.className = `status ${type}`;
        }

        function updateUI() {
            elements.connectBtn.textContent = isConnected ? 'Disconnect' : 'Connect';
            elements.recordBtn.disabled = !isConnected;
            elements.playbackBtn.disabled = !isConnected;
            elements.recordBtn.textContent = isRecording ? 'Stop Recording' : 'Start Recording';
            elements.playbackBtn.textContent = isPlaybackActive ? 'Stop Playback' : 'Start Playback';
        }

        elements.connectBtn.addEventListener('click', async () => {
            if (isConnected) {
                client.disconnect();
                return;
            }

            try {
                client = AzureVoiceLive.createClient({
                    endpoint: elements.endpoint.value,
                    apiKey: elements.apiKey.value,
                    model: elements.model.value
                });

                // Event listeners
                client.on('connected', () => {
                    isConnected = true;
                    updateStatus('Connected to Azure Voice Live', 'success');
                    updateUI();
                });

                client.on('disconnected', () => {
                    isConnected = false;
                    isRecording = false;
                    isPlaybackActive = false;
                    updateStatus('Disconnected');
                    updateUI();
                });

                client.on('sessionCreated', (event) => {
                    elements.sessionInfo.innerHTML = `<strong>Session ID:</strong> ${event.session.id}`;
                });

                client.on('recordingStarted', () => {
                    isRecording = true;
                    updateUI();
                });

                client.on('recordingStopped', () => {
                    isRecording = false;
                    updateUI();
                });

                client.on('playbackStarted', () => {
                    isPlaybackActive = true;
                    updateUI();
                });

                client.on('playbackStopped', () => {
                    isPlaybackActive = false;
                    updateUI();
                });

                client.on('speechStarted', () => {
                    updateStatus('Speech detected...', 'info');
                });

                client.on('speechStopped', () => {
                    updateStatus('Speech ended', 'info');
                });

                client.on('error', (error) => {
                    updateStatus(`Error: ${error.message}`, 'error');
                });

                updateStatus('Connecting...');
                await client.connect({
                    instructions: 'You are a helpful AI assistant responding naturally.',
                    voice: {
                        name: 'en-US-Ava:DragonHDLatestNeural',
                        type: 'azure-standard',
                        temperature: 0.8
                    }
                });

            } catch (error) {
                updateStatus(`Connection failed: ${error.message}`, 'error');
            }
        });

        elements.recordBtn.addEventListener('click', async () => {
            try {
                if (isRecording) {
                    client.stopRecording();
                } else {
                    await client.startRecording();
                }
            } catch (error) {
                updateStatus(`Recording error: ${error.message}`, 'error');
            }
        });

        elements.playbackBtn.addEventListener('click', () => {
            if (isPlaybackActive) {
                client.stopPlayback();
            } else {
                client.startPlayback();
            }
        });

        // // Initialize with sample values
        // elements.endpoint.value = 'https://your-endpoint.azure.com/';
        // elements.apiKey.value = 'your-api-key';
        // elements.model.value = 'your-model';
    </script>
</body>
</html>